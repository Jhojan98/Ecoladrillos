# API REST - Sistema de Inventario de Ecoladrillos

## üéØ Resumen de la actualizaci√≥n del proyecto

El sistema ha evolucionado significativamente con **nuevas funcionalidades de gesti√≥n inteligente de inventario** que incluyen:

‚úÖ **Gesti√≥n avanzada de ecoladrillos con tama√±os y materiales**  
‚úÖ **Control autom√°tico de stock y materiales**  
‚úÖ **Retiros de ecoladrillos con trazabilidad**  
‚úÖ **L√≥gica de negocio integrada**  
‚úÖ **Reportes y an√°lisis de inventario**  

---

## üöÄ Configuraci√≥n y URLs Base

### Base URL
```
http://localhost:8000/api/v1/
```

### üîê Autenticaci√≥n JWT
```
http://localhost:8000/api/auth/
```

#### Endpoints de autenticaci√≥n:
- **POST** `/api/auth/token/` - Obtener token de acceso (login)
- **POST** `/api/auth/token/refresh/` - Renovar token
- **POST** `/api/auth/token/verify/` - Verificar token

#### Ejemplo de autenticaci√≥n:
```bash
curl -X POST http://localhost:8000/api/auth/token/ \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "tu_password"
  }'
```

#### Respuesta de login:
```json
{
  "access": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
  "refresh": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
}
```

#### Usar token en requests:
```bash
curl -H "Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..." \
  http://localhost:8000/api/v1/materiales/
```

## üìã Endpoints principales

### 1. üß± Materiales
- **GET** `/api/v1/materiales/` - Listar todos los materiales
- **POST** `/api/v1/materiales/` - Crear nuevo material
- **GET** `/api/v1/materiales/{id}/` - Obtener material espec√≠fico
- **PUT** `/api/v1/materiales/{id}/` - Actualizar material
- **DELETE** `/api/v1/materiales/{id}/` - Eliminar material

**Endpoints especiales:**
- **GET** `/api/v1/materiales/por_tipo/?tipo=plastico` - Filtrar por tipo
- **GET** `/api/v1/materiales/stock_disponible/` - Solo materiales con stock

### 2. üü¢ Ecoladrillos *(Funcionalidad mejorada)*
- **GET** `/api/v1/ecoladrillos/` - Listar todos los ecoladrillos
- **POST** `/api/v1/ecoladrillos/` - Crear nuevo ecoladrillo
- **GET** `/api/v1/ecoladrillos/{id}/` - Obtener ecoladrillo espec√≠fico
- **PUT** `/api/v1/ecoladrillos/{id}/` - Actualizar ecoladrillo
- **DELETE** `/api/v1/ecoladrillos/{id}/` - Eliminar ecoladrillo

**Nuevos campos disponibles:**
- `size`: Tama√±o (small, medium, large)
- `material_principal`: Material principal requerido
- `cantidad_material_requerida`: Cantidad de material por unidad
- `cantidad`: Stock disponible

**Endpoints especiales:**
- **GET** `/api/v1/ecoladrillos/stock_bajo/` - Ecoladrillos con stock < 10
- **GET** `/api/v1/ecoladrillos/{id}/stock_disponible/` - Stock de un ecoladrillo espec√≠fico
- **GET** `/api/v1/ecoladrillos/reporte_stock/` - Reporte completo de stock

### 3. üìù Registros de Ecoladrillos *(L√≥gica de negocio integrada)*
- **GET** `/api/v1/registros-ecoladrillo/` - Listar registros de producci√≥n
- **POST** `/api/v1/registros-ecoladrillo/` - Registrar nueva producci√≥n *(autom√°ticamente consume materiales)*
- **GET** `/api/v1/registros-ecoladrillo/{id}/` - Obtener registro espec√≠fico
- **PUT** `/api/v1/registros-ecoladrillo/{id}/` - Actualizar registro
- **DELETE** `/api/v1/registros-ecoladrillo/{id}/` - Eliminar registro

**Endpoints especiales:**
- **GET** `/api/v1/registros-ecoladrillo/por_fecha/?fecha_inicio=2024-01-01&fecha_fin=2024-12-31`

### 4. üîÑ Retiros de Ecoladrillos *(Nueva funcionalidad)*
- **GET** `/api/v1/retiros-ecoladrillo/` - Listar retiros
- **POST** `/api/v1/retiros-ecoladrillo/` - Registrar nuevo retiro *(autom√°ticamente reduce stock)*
- **GET** `/api/v1/retiros-ecoladrillo/{id}/` - Obtener retiro espec√≠fico
- **PUT** `/api/v1/retiros-ecoladrillo/{id}/` - Actualizar retiro
- **DELETE** `/api/v1/retiros-ecoladrillo/{id}/` - Eliminar retiro

**Campos requeridos:**
- `ecoladrillo`: ID del ecoladrillo
- `cantidad`: Cantidad a retirar
- `motivo`: Raz√≥n del retiro
- `fecha`: Fecha del retiro

**Endpoints especiales:**
- **GET** `/api/v1/retiros-ecoladrillo/por_fecha/?fecha_inicio=2024-01-01&fecha_fin=2024-12-31`
- **GET** `/api/v1/retiros-ecoladrillo/por_ecoladrillo/?ecoladrillo_id=1`

### 5. üì¶ Registros de Material *(Gesti√≥n autom√°tica de stock)*
- **GET** `/api/v1/registros-material/` - Listar ingresos de material
- **POST** `/api/v1/registros-material/` - Registrar ingreso *(autom√°ticamente suma al stock)*
- **GET** `/api/v1/registros-material/{id}/` - Obtener registro espec√≠fico
- **PUT** `/api/v1/registros-material/{id}/` - Actualizar registro
- **DELETE** `/api/v1/registros-material/{id}/` - Eliminar registro

### 6. üë• Operarios
- **GET** `/api/v1/operarios/` - Listar operarios
- **POST** `/api/v1/operarios/` - Crear operario
- **GET** `/api/v1/operarios/{id}/` - Obtener operario espec√≠fico
- **PUT** `/api/v1/operarios/{id}/` - Actualizar operario
- **DELETE** `/api/v1/operarios/{id}/` - Eliminar operario

### 7. üë®‚Äçüíº Administradores
- **GET** `/api/v1/administradores/` - Listar administradores
- **POST** `/api/v1/administradores/` - Crear administrador
- **GET** `/api/v1/administradores/{id}/` - Obtener administrador espec√≠fico
- **PUT** `/api/v1/administradores/{id}/` - Actualizar administrador
- **DELETE** `/api/v1/administradores/{id}/` - Eliminar administrador

### 8. üìä Reportes *(Funcionalidad extendida)*
- **GET** `/api/v1/reportes/` - Listar reportes
- **POST** `/api/v1/reportes/` - Crear reporte
- **GET** `/api/v1/reportes/resumen_inventario/` - Resumen general del inventario
- **GET** `/api/v1/reportes/resumen_retiros/?fecha_inicio=2024-01-01&fecha_fin=2024-12-31` - An√°lisis de retiros

## üí° Ejemplos de uso actualizados

### 1. Crear un nuevo material
```bash
curl -X POST http://localhost:8000/api/v1/materiales/ \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer tu_token_jwt" \
  -d '{
    "nombre": "Pl√°stico PET Reciclado",
    "tipo": "plastico",
    "cantidad_disponible": 500,
    "unidad_medida": "kg"
  }'
```

### 2. Crear un ecoladrillo *(Con nuevos campos)*
```bash
curl -X POST http://localhost:8000/api/v1/ecoladrillos/ \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer tu_token_jwt" \
  -d '{
    "nombre": "Ecoladrillo Verde Mediano",
    "descripcion": "Ecoladrillo fabricado con materiales reciclados, tama√±o mediano",
    "size": "medium",
    "material_principal": 1,
    "cantidad_material_requerida": 2,
    "cantidad": 0
  }'
```

### 3. Registrar producci√≥n de ecoladrillos *(Consume materiales autom√°ticamente)*
```bash
curl -X POST http://localhost:8000/api/v1/registros-ecoladrillo/ \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer tu_token_jwt" \
  -d '{
    "fecha": "2025-07-31",
    "ecoladrillo": 1,
    "cantidad": 10
  }'
```
> **Nota:** Este endpoint verifica autom√°ticamente si hay suficiente material y consume la cantidad necesaria.

### 4. Registrar retiro de ecoladrillos *(Nueva funcionalidad)*
```bash
curl -X POST http://localhost:8000/api/v1/retiros-ecoladrillo/ \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer tu_token_jwt" \
  -d '{
    "fecha": "2025-07-31",
    "ecoladrillo": 1,
    "cantidad": 5,
    "motivo": "Venta a cliente corporativo"
  }'
```

### 5. Registrar ingreso de material *(Suma stock autom√°ticamente)*
```bash
curl -X POST http://localhost:8000/api/v1/registros-material/ \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer tu_token_jwt" \
  -d '{
    "id_ingreso": 101,
    "fecha": "2025-07-31",
    "cantidad": 100,
    "material": 1,
    "origen": "Proveedor ABC - Donaci√≥n comunitaria"
  }'
```

### 6. Obtener reporte de stock de ecoladrillos
```bash
curl -H "Authorization: Bearer tu_token_jwt" \
  http://localhost:8000/api/v1/ecoladrillos/reporte_stock/
```

### 7. Obtener an√°lisis de retiros por per√≠odo
```bash
curl -H "Authorization: Bearer tu_token_jwt" \
  "http://localhost:8000/api/v1/reportes/resumen_retiros/?fecha_inicio=2025-01-01&fecha_fin=2025-12-31"
```

## üìä Respuestas de ejemplo actualizadas

### Listado de ecoladrillos *(con nuevos campos)*
```json
{
  "count": 3,
  "next": null,
  "previous": null,
  "results": [
    {
      "id_ecoladrillo": 1,
      "nombre": "Ecoladrillo Verde Mediano",
      "descripcion": "Ecoladrillo fabricado con materiales reciclados",
      "size": "medium",
      "size_display": "Medium",
      "material_principal": 1,
      "material_principal_nombre": "Pl√°stico PET Reciclado",
      "cantidad_material_requerida": 2,
      "cantidad": 45
    }
  ]
}
```

### Reporte de stock de ecoladrillos *(nuevo endpoint)*
```json
{
  "total_tipos_ecoladrillos": 5,
  "stock_total": 234,
  "tipos_con_stock_bajo": 2,
  "tipos_sin_stock": 1,
  "ecoladrillos": [
    {
      "id_ecoladrillo": 1,
      "nombre": "Ecoladrillo Verde Mediano",
      "cantidad": 45,
      "material_principal_nombre": "Pl√°stico PET Reciclado"
    }
  ]
}
```

### An√°lisis de retiros *(nueva funcionalidad)*
```json
{
  "total_retiros": 12,
  "cantidad_total_retirada": 156,
  "retiros_por_tipo": {
    "Ecoladrillo Verde Mediano": 89,
    "Ecoladrillo Azul Grande": 67
  },
  "periodo": {
    "fecha_inicio": "2025-01-01",
    "fecha_fin": "2025-07-31"
  }
}
```

### Registro de ecoladrillo *(con validaci√≥n)*
```json
{
  "id_registro": 15,
  "fecha": "2025-07-31",
  "ecoladrillo": 1,
  "ecoladrillo_nombre": "Ecoladrillo Verde Mediano",
  "cantidad": 10
}
```

### Error de validaci√≥n *(stock insuficiente)*
```json
{
  "error": "No hay suficiente Pl√°stico PET Reciclado disponible. Necesario: 20 kg, Disponible: 15 kg",
  "codigo_estado": 400
}
```

### Resumen de inventario actualizado
```json
{
  "total_ecoladrillos": 5,
  "total_materiales": 8,
  "materiales_sin_stock": 2,
  "fecha_consulta": "2025-07-31"
}
```

## ‚ú® Nuevas caracter√≠sticas implementadas

### üéØ **Gesti√≥n Inteligente de Inventario**
‚úÖ **Control autom√°tico de stock** - Los registros y retiros actualizan autom√°ticamente las cantidades  
‚úÖ **Validaci√≥n de materiales** - Verifica disponibilidad antes de permitir producciones  
‚úÖ **Trazabilidad completa** - Seguimiento de todos los movimientos de materiales y ecoladrillos  

### üèóÔ∏è **Modelo de Ecoladrillos Mejorado**
‚úÖ **Tama√±os definidos** - Small, Medium, Large con diferentes requerimientos  
‚úÖ **Material principal asignado** - Cada ecoladrillo tiene un material espec√≠fico  
‚úÖ **C√°lculo autom√°tico** - Determina la cantidad de material necesaria por unidad  

### üì¶ **Sistema de Retiros**
‚úÖ **Retiros trazables** - Registro de salidas con motivo y fecha  
‚úÖ **Reducci√≥n autom√°tica** - El stock se actualiza autom√°ticamente  
‚úÖ **Reportes de retiros** - An√°lisis por per√≠odo y tipo de ecoladrillo  

### üîß **L√≥gica de Negocio Integrada**
‚úÖ **Validaciones autom√°ticas** - Previene operaciones inv√°lidas  
‚úÖ **Manejo de errores mejorado** - Respuestas consistentes y claras  
‚úÖ **Transacciones seguras** - Operaciones at√≥micas para mantener integridad  

### üìä **Reportes Avanzados**
‚úÖ **An√°lisis de stock** - Reportes detallados de inventario  
‚úÖ **Seguimiento de retiros** - Estad√≠sticas de salidas por per√≠odo  
‚úÖ **Alertas de stock bajo** - Identificaci√≥n autom√°tica de niveles cr√≠ticos  

### üîê **Seguridad y Autenticaci√≥n**
‚úÖ **JWT configurado** - Autenticaci√≥n moderna y segura  
‚úÖ **Tokens de renovaci√≥n** - Sistema de refresh tokens  
‚úÖ **Manejo de permisos** - Base para control de acceso  

### üê≥ **Infraestructura Docker**
‚úÖ **Contenedores optimizados** - Django + MySQL en Docker  
‚úÖ **Migraciones autom√°ticas** - Configuraci√≥n de base de datos automatizada  
‚úÖ **Variables de entorno** - Configuraci√≥n flexible y segura  

## üö® Validaciones importantes del sistema

### Al registrar producci√≥n de ecoladrillos:
1. **Verifica stock de material** - Calcula si hay suficiente material disponible
2. **Consume material autom√°ticamente** - Reduce la cantidad del material principal
3. **Aumenta stock de ecoladrillos** - Suma la cantidad producida al inventario

### Al registrar retiros:
1. **Verifica stock disponible** - Confirma que hay suficientes ecoladrillos
2. **Reduce stock autom√°ticamente** - Actualiza la cantidad disponible
3. **Registra trazabilidad** - Guarda motivo y fecha del retiro

### Al registrar ingreso de materiales:
1. **Aumenta stock autom√°ticamente** - Suma la cantidad al material correspondiente
2. **Registra origen** - Mantiene trazabilidad de la fuente del material

## üõ†Ô∏è Configuraci√≥n t√©cnica actual

### Tecnolog√≠as implementadas:
- **Django 5.2.4** - Framework web principal
- **Django REST Framework 3.15.2** - API REST
- **MySQL 8.0** - Base de datos
- **JWT Authentication** - djangorestframework-simplejwt 5.3.1
- **Docker & Docker Compose** - Contenedorizaci√≥n

### Estructura del proyecto actualizada:
```
Inventario/
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ serializers.py    # ‚úÖ Serializers con campos relacionados
‚îÇ   ‚îú‚îÄ‚îÄ views.py          # ‚úÖ ViewSets con l√≥gica de negocio
‚îÇ   ‚îú‚îÄ‚îÄ urls.py           # ‚úÖ 8 endpoints principales configurados
‚îÇ   ‚îú‚îÄ‚îÄ auth_urls.py      # ‚úÖ Autenticaci√≥n JWT
‚îÇ   ‚îî‚îÄ‚îÄ exceptions.py     # ‚úÖ Manejo personalizado de errores
‚îú‚îÄ‚îÄ models.py             # ‚úÖ Modelos con l√≥gica de inventario
‚îú‚îÄ‚îÄ admin.py              # ‚úÖ Panel de administraci√≥n configurado
‚îî‚îÄ‚îÄ migrations/           # ‚úÖ 6 migraciones aplicadas
```

### √öltimas migraciones aplicadas:
- **0006** - Reestructuraci√≥n del modelo Ecoladrillo con tama√±os y material principal
- **0005** - Adici√≥n de campo ecoladrillo en RetiroEcoladrillo
- **0004-0003** - Optimizaciones en el modelo de registro

## üîß Pr√≥ximos pasos recomendados

### 1. **üîê Seguridad avanzada**
- Implementar permisos por rol (Operario vs Administrador)
- Configurar CORS para frontend
- A√±adir rate limiting

### 2. **üìä Analytics y reportes**
- Dashboard de m√©tricas en tiempo real
- Gr√°ficos de producci√≥n vs consumo
- Proyecciones de inventario

### 3. **üöÄ Optimizaciones**
- Cache de consultas frecuentes
- Compresi√≥n de respuestas JSON
- Logs de auditor√≠a

### 4. **üß™ Testing**
- Tests unitarios para modelos
- Tests de integraci√≥n para APIs
- Tests de carga para endpoints

### 5. **üìñ Documentaci√≥n autom√°tica**
- Integraci√≥n con Swagger/OpenAPI
- Documentaci√≥n interactiva
- Ejemplos de c√≥digo autom√°ticos

## üöÄ C√≥mo ejecutar el proyecto

### Usando Docker (Recomendado):
```bash
# 1. Clonar el repositorio
git clone https://github.com/Jhojan98/Ecoladrillos.git
cd Ecoladrillos

# 2. Configurar variables de entorno
cp .env.example .env.dev
# Editar .env.dev con tus configuraciones

# 3. Levantar los servicios
docker compose --env-file .env.dev up --build

# 4. La API estar√° disponible en:
# http://localhost:8000/api/v1/
```

### Acceso al panel de administraci√≥n:
```bash
# Crear superusuario
docker compose exec web python manage.py createsuperuser

# Acceder en: http://localhost:8000/admin/
```

### Testing de la API:
1. **Interfaz navegable**: `http://localhost:8000/api/v1/`
2. **Postman/Insomnia**: Importar colecci√≥n con los endpoints
3. **cURL**: Usar los ejemplos de esta documentaci√≥n

## üèóÔ∏è Estructura de modelos actualizada

### Ecoladrillo *(Modelo principal mejorado)*
```python
{
  "id_ecoladrillo": "AutoField (PK)",
  "nombre": "CharField(100)",
  "descripcion": "TextField",
  "size": "CharField (small/medium/large)",
  "material_principal": "ForeignKey(Material)",
  "cantidad_material_requerida": "IntegerField",
  "cantidad": "IntegerField (stock actual)"
}
```

### Material
```python
{
  "id_insumo": "AutoField (PK)",
  "nombre": "CharField(100)",
  "tipo": "CharField(50)",
  "cantidad_disponible": "IntegerField",
  "unidad_medida": "CharField(20)"
}
```

### RegistroEcoladrillo *(Con l√≥gica autom√°tica)*
```python
{
  "id_registro": "AutoField (PK)",
  "fecha": "DateField",
  "ecoladrillo": "ForeignKey(Ecoladrillo)",
  "cantidad": "IntegerField"
}
```

### RetiroEcoladrillo *(Nuevo modelo)*
```python
{
  "id_retiro": "AutoField (PK)",
  "fecha": "DateField",
  "ecoladrillo": "ForeignKey(Ecoladrillo)",
  "cantidad": "IntegerField",
  "motivo": "CharField(200)"
}
```
